var S=Object.defineProperty,A=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var w=(t,e,o)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,f=(t,e)=>{for(var o in e||(e={}))O.call(e,o)&&w(t,o,e[o]);if(D)for(var o of D(e))I.call(e,o)&&w(t,o,e[o]);return t},h=(t,e)=>A(t,E(e));import{o as u,c as p,n as M,a as m,t as v,b as N,r as P,d as c,F as x,e as b,w as k,f as H,g as L,h as K}from"./vendor.baaf14da.js";const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};R();var T=(t,e)=>{const o=t.__vccOpts||t;for(const[i,n]of e)o[i]=n;return o};const F={props:["id","x","y","size","color","content"],data(){return{dragging:!1}},computed:{style(){return{left:`${this.x-this.size/2}px`,top:`${this.y-this.size/2}px`,width:`${this.size}px`,height:`${this.size}px`,backgroundColor:this.color,fontSize:`${this.size*.75}px`}}},methods:{startDrag(t){t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move";const e=this.size/2-t.offsetX,o=this.size/2-t.offsetY;t.dataTransfer.setData("id",this.id),t.dataTransfer.setData("shiftX",e),t.dataTransfer.setData("shiftY",o),this.dragging=!0},dragEnd(){this.dragging=!1}}},V=["textContent"];function Y(t,e,o,i,n,r){return u(),p("div",{class:M(["block",{dragging:n.dragging}]),style:m(r.style),draggable:"true",onDragstart:e[0]||(e[0]=(...d)=>r.startDrag&&r.startDrag(...d)),onDragend:e[1]||(e[1]=(...d)=>r.dragEnd&&r.dragEnd(...d)),textContent:v(o.content)},null,46,V)}var X=T(F,[["render",Y],["__scopeId","data-v-625f0f12"]]);function C(t){return{states:[t],position:1}}function j(t,e){const o=[...t.states.slice(0,t.position),e],i=o.length;return h(f({},t),{states:o,position:i})}function G({states:t,position:e}){return t[e-1]}function B({position:t}){return t>1}function z({states:t,position:e}){return e<t.length}function Z(t){if(!B(t))throw new Error("Can't undo!");return h(f({},t),{position:t.position-1})}function J(t){if(!z(t))throw new Error("Can't redo!");return h(f({},t),{position:t.position+1})}const g=100,y=100,q={components:{DemoBlock:X},data(){return{history:null,maxCol:0,maxRow:0}},computed:{scene(){return this.history?G(this.history):[]},undoable(){return Boolean(this.history&&B(this.history))},redoable(){return Boolean(this.history&&z(this.history))},hasUnsavedChanges(){return this.undoable},grid(){return this.scene.reduce((t,e)=>{t[e.x]||(t[e.x]=[]),t[e.x][e.y]=e},{})},pickerItems(){return[{id:101,color:"red",content:"\u{1F435}"},{id:102,color:"navy",content:"\u{1F991}"},{id:103,color:"yellow",content:"\u{1F436}"},{id:104,color:"darkblue",content:"\u{1F431}"}]}},mounted(){const{scrollWidth:t,scrollHeight:e}=this.$refs.canvas;this.maxCol=Math.ceil((t-2*y)/g),this.maxRow=Math.ceil((e-2*y)/g),this.history=C([]);try{const o=JSON.parse(localStorage.scene);Array.isArray(o)&&(this.history=C(o))}catch{this.history=C([])}this.keyHandler=o=>{if(o.target.getAttribute("contenteditable")==="true")return;const n=o.code==="KeyZ"&&o.ctrlKey||o.code==="Backspace"&&o.ctrlKey,r=o.code==="KeyY"&&o.ctrlKey;n&&this.undoable&&(this.undo(),o.stopPropagation()),r&&this.redoable&&(this.redo(),o.stopPropagation())},document.addEventListener("keydown",this.keyHandler)},beforeDestroy(){document.removeEventListener("keydown",this.keyHandler)},methods:{save(){localStorage.scene=JSON.stringify(this.scene)},updateScene(t){this.history=j(this.history,t),this.save()},undo(){this.history=Z(this.history),this.save()},redo(){this.history=J(this.history),this.save()},gridToCanvas(t,e){const o=t*g+y,i=e*g+y;return{x:o,y:i}},snapToGrid(t,e){const o=Math.round((t-y)/g),i=Math.round((e-y)/g);return{col:o,row:i}},placeAt(t,e,o){const i=this.scene.reduce((a,l)=>(a[l.x]||(a[l.x]={}),a[l.x][l.y]=l,a),{}),n=(a,l)=>i[a]&&i[a][l],r=(a,l,_)=>{i[a]||(i[a]={}),i[a][l]=h(f({},_),{x:a,y:l})},d=n(t,e);if(d&&d.id!==o.id)if(!n(t+1,e)&&t<this.maxCol-1)r(t+1,e,d);else if(!n(t-1,e)&&t>0)r(t-1,e,d);else if(!n(t,e+1)&&e<this.maxRow-1)r(t,e+1,d);else if(!n(t,e-1)&&e>0)r(t,e-1,d);else return!1;n(o.x,o.y)&&(i[o.x][o.y]=null),r(t,e,o);const s=Object.values(i).filter(Boolean).reduce((a,l)=>[...a,...Object.values(l)].filter(Boolean),[]);return this.updateScene(s),!0},onDrop(t){const{offsetLeft:e,offsetTop:o,scrollLeft:i,scrollTop:n}=this.$refs.canvas,r=t.dataTransfer.getData("id"),d={x:t.pageX-e+i,y:t.pageY-o+n},{row:s,col:a}=this.snapToGrid(d.x,d.y);if(!(a<0||a>this.maxCol-1||s<0||s>this.maxRow-1))if(+r){const l=this.pickerItems.find(_=>_.id===+r);l&&this.placeAt(a,s,h(f({},l),{id:N(),x:a,y:s}))}else{const l=this.scene.find(_=>_.id===r);this.placeAt(a,s,l)}},onDelete(t){const e=t.dataTransfer.getData("id");if(+e)return;const o=this.scene.filter(i=>i.id!==e);this.updateScene(o)}}},U={class:"layout"},W={class:"picker"},Q=c("div",{class:"separator"},null,-1),$=["textContent"],ee={class:"header"},te=c("h1",null,"Vue dragging demo",-1),oe=["disabled"],re=c("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},[c("path",{fill:"currentColor",d:"M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z"})],-1),se=[re],ne=["disabled"],ie=c("svg",{style:{width:"24px",height:"24px"},viewBox:"0 0 24 24"},[c("path",{fill:"currentColor",d:"M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z"})],-1),ae=[ie];function de(t,e,o,i,n,r){const d=P("DemoBlock");return u(),p("div",U,[c("aside",W,[(u(!0),p(x,null,b(r.pickerItems,(s,a)=>(u(),L(d,{id:s.id,x:100-3,y:50+a*120,size:80,color:s.color,content:s.content,key:s.id},null,8,["id","y","color","content"]))),128)),Q,c("div",{class:"trash-can",onDrop:e[0]||(e[0]=(...s)=>r.onDelete&&r.onDelete(...s)),onDragover:e[1]||(e[1]=k(()=>{},["prevent"])),onDragenter:e[2]||(e[2]=k(()=>{},["prevent"])),textContent:v("\u{1F5D1}\uFE0F")},null,40,$)]),c("header",ee,[te,c("button",{onClick:e[3]||(e[3]=(...s)=>r.undo&&r.undo(...s)),disabled:!r.undoable},se,8,oe),c("button",{onClick:e[4]||(e[4]=(...s)=>r.redo&&r.redo(...s)),disabled:!r.redoable},ae,8,ne)]),c("main",{class:"canvas",ref:"canvas",onDrop:e[5]||(e[5]=(...s)=>r.onDrop&&r.onDrop(...s)),onDragover:e[6]||(e[6]=k(()=>{},["prevent"])),onDragenter:e[7]||(e[7]=k(()=>{},["prevent"]))},[(u(),p(x,null,b(20,s=>c("span",{key:s,style:m({position:"absolute",left:`${(s-1)*100+100}px`,borderLeft:"1px solid black"})},v(s),5)),64)),(u(),p(x,null,b(10,s=>c("span",{key:s,style:m({position:"absolute",top:`${(s-1)*100+100}px`,transform:"rotate(-90deg)",borderRight:"1px solid black",paddingTop:"6px"})},v(s),5)),64)),n.history?(u(!0),p(x,{key:0},b(r.scene,s=>(u(),L(d,{id:s.id,x:r.gridToCanvas(s.x,s.y).x,y:r.gridToCanvas(s.x,s.y).y,size:80,color:s.color,content:s.content,key:s.id},null,8,["id","x","y","color","content"]))),128)):H("",!0)],544)])}var le=T(q,[["render",de]]);K(le).mount("#app");
